"use strict";(self.webpackChunkwormhole_connector=self.webpackChunkwormhole_connector||[]).push([[5361],{3556:(e,t,n)=>{n.d(t,{a:()=>o,d:()=>a,g:()=>c,n:()=>s});var r=n(7547);const i=e=>"string"==typeof e?r.d.Buffer.from(e):e;function a(e,t){return r.af.findProgramAddressSync(Array.isArray(e)?e.map(i):[i(e)],new r.af(t))[0]}function s(e,t){return{pubkey:new r.af(e),isWritable:!0,isSigner:t}}function o(e,t){return{pubkey:new r.af(e),isWritable:!1,isSigner:t}}function c(e){if(null===e)throw Error("account info is null");return e.data}},4416:(e,t,n)=>{n.d(t,{c:()=>s});var r=n(9379),i=n(7547);function a(e){return[...i.dn,(0,i.dp)(e)]}function s(e,t){const[n,s]=(0,i.dl)(e),o=(0,i.dm)(a(e),t);return(0,r.A)((0,r.A)((0,r.A)({protocolName:n,payloadName:s,payloadLiteral:e},(0,i.dm)(i.dq,t)),o),{},{hash:(0,i.aO)((0,i.aN)(a(e),o))})}},5361:(e,t,n)=>{n.r(t),n.d(t,{B:()=>h,S:()=>Ie,a:()=>F,b:()=>z,c:()=>x,d:()=>G,e:()=>q,f:()=>U,g:()=>ye,h:()=>A,i:()=>S,j:()=>ge,k:()=>y,l:()=>N,m:()=>we,n:()=>B,o:()=>j,p:()=>be});var r=n(9379),i=n(8951),a=n(9495),s=n(6218),o=n(600),c=n(7547),u=n(195),d=n(3556),g=n(8080),m=n(4416),l=n(9801),f=Object.defineProperty,p=(e,t,n)=>((e,t,n)=>t in e?f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);const h=new c.af("BPFLoaderUpgradeab1e11111111111111111111111");function y(e){return(0,d.d)([new c.af(e).toBuffer()],h)}class w extends Error{constructor(e){super(e),this.name="IdlError"}}function S(e,t){switch(t.type.kind){case"struct":return t.type.fields.map(t=>v(e,t.type)).reduce((e,t)=>e+t,0);case"enum":{const n=t.type.variants.map(t=>t.fields?t.fields.map(t=>v(e,"object"==typeof t&&"name"in t?t.type:t)).reduce((e,t)=>e+t,0):0);return Math.max(...n)+1}case"alias":return v(e,t.type.value)}}function v(e,t){var n;switch(t){case"bool":case"u8":case"i8":case"bytes":case"string":return 1;case"i16":case"u16":return 2;case"u32":case"i32":case"f32":return 4;case"u64":case"i64":case"f64":return 8;case"u128":case"i128":return 16;case"u256":case"i256":case"publicKey":return 32;default:if("vec"in t)return 1;if("option"in t)return 1+v(e,t.option);if("coption"in t)return 4+v(e,t.coption);if("defined"in t){var r;const i=null!==(r=null==(n=e.types)?void 0:n.filter(e=>e.name===t.defined))&&void 0!==r?r:[];if(1!==i.length)throw new w("Type not found: ".concat(JSON.stringify(t)));return S(e,i[0])}if("array"in t){let n=t.array[0],r=t.array[1];return v(e,n)*r}throw new Error("Invalid type ".concat(JSON.stringify(t)))}}function I(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0===t?e.toLowerCase():e.toUpperCase()}).replace(/[\s\-_]+/g,"")}const b=[{name:"discriminator",binary:"bytes",size:4},{name:"consistencyLevel",binary:"uint",size:1,endianness:"little"},(0,r.A)({name:"emitterAuthority"},c.aJ),{name:"messageStatus",binary:"uint",size:1,endianness:"little"},{name:"gap",binary:"uint",size:3},{name:"timestamp",binary:"uint",size:4,endianness:"little"},{name:"nonce",binary:"uint",size:4,endianness:"little"},{name:"sequence",binary:"uint",size:8,endianness:"little"},{name:"emitterChain",binary:"uint",size:2,endianness:"little"},(0,r.A)({name:"emitterAddress"},c.aJ),{name:"payloadLength",binary:"uint",size:4,endianness:"little"},{name:"payload",binary:"bytes"}];function M(e){return(0,c.a_)(b,e)}function A(e,t,n,r){const i="string"==typeof t?c.d.Buffer.from(t,"hex"):c.d.Buffer.from(t);if(32!=i.length)throw Error("address.length != 32");const a=c.d.Buffer.alloc(8);return a.writeBigUInt64BE("number"==typeof r?BigInt(r):r),(0,d.d)([i,(()=>{const e=c.d.Buffer.alloc(2);return e.writeUInt16BE(n),e})(),a],e)}async function B(e,t,n,r,i,a){return e.getAccountInfo(A(t,n,r,i),a).then(e=>!!(0,d.g)(e)[0])}function x(e){return(0,d.d)([c.d.Buffer.from("Bridge")],e)}async function P(e,t,n){return e.getAccountInfo(x(t),n).then(e=>L.deserialize((0,d.g)(e)))}class E{constructor(e,t){p(this,"guardianSetExpirationTime"),p(this,"fee"),this.guardianSetExpirationTime=e,this.fee=t}static deserialize(e){if(12!=e.length)throw new Error("data.length != 12");const t=e.readUInt32LE(0),n=e.readBigUInt64LE(4);return new E(t,n)}}class L{constructor(e,t,n){p(this,"guardianSetIndex"),p(this,"lastLamports"),p(this,"config"),this.guardianSetIndex=e,this.lastLamports=t,this.config=n}static deserialize(e){if(24!=e.length)throw new Error("data.length != 24");const t=e.readUInt32LE(0),n=e.readBigUInt64LE(4),r=E.deserialize(e.subarray(12));return new L(t,n,r)}}function U(e,t){return(0,d.d)([c.d.Buffer.from("Sequence"),new c.af(e).toBytes()],t)}async function C(e,t,n,r){return e.getAccountInfo(U(t,n),r).then(e=>k.deserialize((0,d.g)(e)))}class k{constructor(e,t,n){p(this,"sequence"),p(this,"bump"),p(this,"emitterType"),this.sequence=e,this.bump=t,this.emitterType=n}static deserialize(e){if(8!==e.length&&10!==e.length)throw new Error("data.length != 8 or data.length != 10");let t,n;const r=e.readBigUInt64LE(0);return 10===e.length&&(t=e[8],n=e[9]),new k(r,t,n)}value(){return this.sequence}}function q(e){return(0,d.d)([c.d.Buffer.from("emitter")],e)}function T(e,t){const n=q(e);return{emitter:n,sequence:U(n,t)}}async function z(e,t,n,r){return C(e,q(t),n,r)}function F(e){return(0,d.d)([c.d.Buffer.from("fee_collector")],e)}function K(e,t,n){return new c.at({keys:[],programId:c.df.programId,data:_.serialize(e,t,n)})}class _{static serialize(e,t,n){if(0==e.length)throw Error("signatures.length == 0");if(e.length!=t.length)throw Error("signatures.length != keys.length");if(32!=n.length)throw Error("message.length != 32");const r=e.length,i=11,a=1+r*i,s=a+85*r,o=c.d.Buffer.alloc(s+32);o.writeUInt8(r,0),o.write(n.toString("hex"),s,"hex");for(let c=0;c<r;++c){const n=e.at(c);if(65!=(null==n?void 0:n.length))throw Error("signatures[".concat(c,"].length != 65"));const r=t.at(c);if(20!=(null==r?void 0:r.length))throw Error("keys[".concat(c,"].length != 20"));const u=a+85*c,d=u+65;o.writeUInt16LE(u,1+c*i),o.writeUInt8(0,3+c*i),o.writeUInt16LE(d,4+c*i),o.writeUInt8(0,6+c*i),o.writeUInt16LE(s,7+c*i),o.writeUInt16LE(32,9+c*i),o.writeUInt8(0,10+c*i),o.write(n.toString("hex"),u,"hex"),o.write(r.toString("hex"),d,"hex")}return o}}function V(e,t){return(0,d.d)([c.d.Buffer.from("GuardianSet"),(()=>{const e=c.d.Buffer.alloc(4);return e.writeUInt32BE(t),e})()],e)}async function W(e,t,n,r){return e.getAccountInfo(V(t,n),r).then(e=>D.deserialize((0,d.g)(e)))}class D{constructor(e,t,n,r){p(this,"index"),p(this,"keys"),p(this,"creationTime"),p(this,"expirationTime"),this.index=e,this.keys=t,this.creationTime=n,this.expirationTime=r}static deserialize(e){const t=e.readUInt32LE(0),n=e.readUInt32LE(4),r=8+20*n,i=e.readUInt32LE(r),a=e.readUInt32LE(4+r),s=[];for(let o=0;o<n;++o){const t=8+20*o;s.push(e.subarray(t,t+20))}return new D(t,s,i,a)}}function G(e,t){return(0,d.d)([c.d.Buffer.from("PostedVAA"),t],e)}class O{constructor(e,t,n){p(this,"signatures"),p(this,"hash"),p(this,"guardianSetIndex"),this.signatures=e,this.hash=t,this.guardianSetIndex=n}static deserialize(e){const t=e.readUInt32LE(0),n=[...e.subarray(4,4+t)].map(e=>0!=e),r=4+t,i=e.subarray(r,r+32),a=e.readUInt32LE(r+32);return new O(n,i,a)}}function N(e){return(0,d.d)([c.d.Buffer.from("upgrade")],e)}function j(e,t,n){return c.ao.transfer({fromPubkey:new c.af(t),toPubkey:F(e),lamports:n})}class J{constructor(e){p(this,"idl"),this.idl=e}async encode(e,t){throw new Error("Invalid account name: ".concat(e))}decode(e,t){return this.decodeUnchecked(e,t)}decodeUnchecked(e,t){throw new Error("Invalid account name: ".concat(e))}memcmp(e,t){if("postVaa"===e)return{dataSize:56};throw new Error("Invalid account name: ".concat(e))}size(e){var t;return null!==(t=S(this.idl,e))&&void 0!==t?t:0}}class R{constructor(e){}decode(e){throw new Error("Wormhole program does not have events")}}class X{static fieldLayout(e,t){const n=void 0!==e.name?I(e.name):void 0;switch(e.type){case"bool":return u.d.bool(n);case"u8":return u.d.u8(n);case"i8":return u.d.i8(n);case"u16":return u.d.u16(n);case"i16":return u.d.i16(n);case"u32":return u.d.u32(n);case"i32":return u.d.i32(n);case"f32":return u.d.f32(n);case"u64":return u.d.u64(n);case"i64":return u.d.i64(n);case"f64":return u.d.f64(n);case"u128":return u.d.u128(n);case"i128":return u.d.i128(n);case"u256":return u.d.u256(n);case"i256":return u.d.i256(n);case"bytes":return u.d.vecU8(n);case"string":return u.d.str(n);case"publicKey":return u.d.publicKey(n);default:if("vec"in e.type)return u.d.vec(X.fieldLayout({name:void 0,type:e.type.vec},t),n);if("option"in e.type)return u.d.option(X.fieldLayout({name:void 0,type:e.type.option},t),n);if("array"in e.type){let r=e.type.array[0],i=e.type.array[1],a=X.fieldLayout({name:void 0,type:r},t);return u.d.array(a,i,n)}throw new Error("Not yet implemented: ".concat(e))}}}class Z{constructor(e){p(this,"ixLayout"),this.ixLayout=Z.parseIxLayout(e)}static parseIxLayout(e){const t=(e.instructions?e.instructions:[]).map(t=>{let n=t.args.map(t=>{var n,r;return X.fieldLayout(t,Array.from([...null!==(n=e.accounts)&&void 0!==n?n:[],...null!==(r=e.types)&&void 0!==r?r:[]]))});const r=I(t.name);return[r,u.d.struct(n,r)]}).concat(e.instructions.map(t=>{let n=t.args.map(t=>{var n,r;return X.fieldLayout(t,Array.from([...null!==(n=e.accounts)&&void 0!==n?n:[],...null!==(r=e.types)&&void 0!==r?r:[]]))});const r=I(t.name);return[r,u.d.struct(n,r)]}));return new Map(t)}encode(e,t){const n=c.d.Buffer.alloc(1e3),r=I(e),i=this.ixLayout.get(r);if(!i)throw new Error("Unknown method: ".concat(r));const a=i.encode(t,n),s=n.slice(0,a);return function(e,t){const n=c.d.Buffer.alloc(1+(void 0===t?0:t.length));return n.writeUInt8(e,0),void 0!==t&&n.write(t.toString("hex"),1,"hex"),n}(H[(o=r,o.charAt(0).toUpperCase()+o.slice(1))],s);var o}encodeState(e,t){throw new Error("Wormhole program does not have state")}decode(e){var t;var n;"string"==typeof e&&(e="hex"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hex")?c.d.Buffer.from(e,"hex"):c.c4.decode(e));let r=c.d.Buffer.from(e.slice(0,1)).readInt8(),i=c.d.Buffer.from(e.slice(1)),a=I(null!==(t=H[r])&&void 0!==t?t:"");return this.ixLayout.get(a)?{data:null==(n=this.ixLayout.get(a))?void 0:n.decode(i),name:a}:null}}var H,Q;(Q=H||(H={}))[Q.Initialize=0]="Initialize",Q[Q.PostMessage=1]="PostMessage",Q[Q.PostVaa=2]="PostVaa",Q[Q.SetFees=3]="SetFees",Q[Q.TransferFees=4]="TransferFees",Q[Q.UpgradeContract=5]="UpgradeContract",Q[Q.UpgradeGuardianSet=6]="UpgradeGuardianSet",Q[Q.VerifySignatures=7]="VerifySignatures",Q[Q.PostMessageUnreliable=8]="PostMessageUnreliable";class Y{constructor(e){}encode(e,t){throw new Error("Wormhole program does not have state")}decode(e){throw new Error("Wormhole program does not have state")}}class ${constructor(e){}encode(e,t){throw new Error("Wormhole program does not have user-defined types")}decode(e,t){throw new Error("Wormhole program does not have user-defined types")}}class ee{constructor(e){p(this,"instruction"),p(this,"accounts"),p(this,"state"),p(this,"events"),p(this,"types"),this.instruction=new Z(e),this.accounts=new J(e),this.state=new Y(e),this.events=new R(e),this.types=new $(e)}}const te={version:"0.1.0",name:"wormhole",instructions:[{name:"initialize",accounts:[{name:"bridge",isMut:!0,isSigner:!1},{name:"guardianSet",isMut:!0,isSigner:!1},{name:"feeCollector",isMut:!0,isSigner:!1},{name:"payer",isMut:!0,isSigner:!0},{name:"clock",isMut:!1,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"guardianSetExpirationTime",type:"u32"},{name:"fee",type:"u64"},{name:"initialGuardians",type:{vec:{array:["u8",20]}}}]},{name:"postMessage",accounts:[{name:"bridge",isMut:!0,isSigner:!1},{name:"message",isMut:!0,isSigner:!0},{name:"emitter",isMut:!1,isSigner:!0},{name:"sequence",isMut:!0,isSigner:!1},{name:"payer",isMut:!0,isSigner:!0},{name:"feeCollector",isMut:!0,isSigner:!1},{name:"clock",isMut:!1,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"nonce",type:"u32"},{name:"payload",type:"bytes"},{name:"consistencyLevel",type:"u8"}]},{name:"postVaa",accounts:[{name:"guardianSet",isMut:!1,isSigner:!1},{name:"bridge",isMut:!1,isSigner:!1},{name:"signatureSet",isMut:!1,isSigner:!1},{name:"vaa",isMut:!0,isSigner:!1},{name:"payer",isMut:!0,isSigner:!0},{name:"clock",isMut:!1,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"version",type:"u8"},{name:"guardianSetIndex",type:"u32"},{name:"timestamp",type:"u32"},{name:"nonce",type:"u32"},{name:"emitterChain",type:"u16"},{name:"emitterAddress",type:{array:["u8",32]}},{name:"sequence",type:"u64"},{name:"consistencyLevel",type:"u8"},{name:"payload",type:"bytes"}]},{name:"setFees",accounts:[{name:"payer",isMut:!0,isSigner:!0},{name:"bridge",isMut:!0,isSigner:!1},{name:"vaa",isMut:!1,isSigner:!1},{name:"claim",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"transferFees",accounts:[{name:"payer",isMut:!0,isSigner:!0},{name:"bridge",isMut:!0,isSigner:!1},{name:"vaa",isMut:!1,isSigner:!1},{name:"claim",isMut:!0,isSigner:!1},{name:"feeCollector",isMut:!0,isSigner:!1},{name:"recipient",isMut:!0,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"upgradeContract",accounts:[{name:"payer",isMut:!0,isSigner:!0},{name:"bridge",isMut:!0,isSigner:!1},{name:"vaa",isMut:!1,isSigner:!1},{name:"claim",isMut:!0,isSigner:!1},{name:"upgradeAuthority",isMut:!1,isSigner:!1},{name:"spill",isMut:!0,isSigner:!1},{name:"implementation",isMut:!0,isSigner:!1},{name:"programData",isMut:!0,isSigner:!1},{name:"wormholeProgram",isMut:!0,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"clock",isMut:!1,isSigner:!1},{name:"bpfLoaderUpgradeable",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"upgradeGuardianSet",accounts:[{name:"payer",isMut:!0,isSigner:!0},{name:"bridge",isMut:!0,isSigner:!1},{name:"vaa",isMut:!1,isSigner:!1},{name:"claim",isMut:!0,isSigner:!1},{name:"guardianSetOld",isMut:!0,isSigner:!1},{name:"guardianSetNew",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"verifySignatures",accounts:[{name:"payer",isMut:!0,isSigner:!0},{name:"guardianSet",isMut:!1,isSigner:!1},{name:"signatureSet",isMut:!0,isSigner:!0},{name:"instructions",isMut:!1,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"signatureStatus",type:{array:["i8",19]}}]},{name:"postMessageUnreliable",accounts:[{name:"bridge",isMut:!0,isSigner:!1},{name:"message",isMut:!0,isSigner:!0},{name:"emitter",isMut:!1,isSigner:!0},{name:"sequence",isMut:!0,isSigner:!1},{name:"payer",isMut:!0,isSigner:!0},{name:"feeCollector",isMut:!0,isSigner:!1},{name:"clock",isMut:!1,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"nonce",type:"u32"},{name:"payload",type:"bytes"},{name:"consistencyLevel",type:"u8"}]}],accounts:[{name:"PostedMessage",type:{kind:"struct",fields:[{name:"vaaVersion",type:"u8"},{name:"consistencyLevel",type:"u8"},{name:"vaaTime",type:"u32"},{name:"vaaSignatureAccount",type:"publicKey"},{name:"submissionTime",type:"u32"},{name:"nonce",type:"u32"},{name:"sequence",type:"u64"},{name:"emitterChain",type:"u16"},{name:"emitterAddress",type:{array:["u8",32]}},{name:"payload",type:"bytes"}]}},{name:"PostedVAA",type:{kind:"struct",fields:[{name:"vaaVersion",type:"u8"},{name:"consistencyLevel",type:"u8"},{name:"vaaTime",type:"u32"},{name:"vaaSignatureAccount",type:"publicKey"},{name:"submissionTime",type:"u32"},{name:"nonce",type:"u32"},{name:"sequence",type:"u64"},{name:"emitterChain",type:"u16"},{name:"emitterAddress",type:{array:["u8",32]}},{name:"payload",type:"bytes"}]}}]};function ne(e,t){return new u.P(te,new c.af(e),void 0===t?{connection:null}:t,ie())}function re(e,t){return ne(e,(0,u.c)(t))}function ie(){return new ee(te)}function ae(e,t,n){return{payer:new c.af(t),bridge:x(e),vaa:G(e,c.d.Buffer.from(n.hash)),claim:A(e,n.emitterAddress.toString(),(0,c.aP)(n.emitterChain),n.sequence),systemProgram:c.ao.programId}}function se(e,t,n,r){return{payer:new c.af(t),bridge:x(e),vaa:G(e,c.d.Buffer.from(r.hash)),claim:A(e,r.emitterAddress.toString(),(0,c.aP)(r.emitterChain),r.sequence),feeCollector:F(e),recipient:new c.af(n),rent:c.ar,systemProgram:c.ao.programId}}function oe(e,t,n){return{payer:new c.af(t),bridge:x(e),vaa:G(e,c.d.Buffer.from(n.hash)),claim:A(e,n.emitterAddress.toString(),(0,c.aP)(n.emitterChain),n.sequence),guardianSetOld:V(e,n.guardianSet),guardianSetNew:V(e,n.guardianSet+1),systemProgram:c.ao.programId}}function ce(e,t,n,r){const{newContract:i}=n.payload.actionArgs;return{payer:new c.af(t),bridge:x(e),vaa:G(e,c.d.Buffer.from(n.hash)),claim:A(e,n.emitterAddress.toString(),(0,c.aP)(n.emitterChain),n.sequence),upgradeAuthority:N(e),spill:new c.af(void 0===r?t:r),implementation:new c.b1(i).unwrap(),programData:y(e),wormholeProgram:new c.af(e),rent:c.ar,clock:c.aq,bpfLoaderUpgradeable:h,systemProgram:c.ao.programId}}function ue(e,t){return{bridge:x(e),guardianSet:V(e,0),feeCollector:F(e),payer:new c.af(t),clock:c.aq,rent:c.ar,systemProgram:c.ao.programId}}function de(e,t,n,r,i,a,s){const o=re(t,e).methods.postMessage(a,c.d.Buffer.from(i),s);return o._ixFn(...o._args,{accounts:ge(t,n,r),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})}function ge(e,t,n,r){let i;return r?({emitter:r,sequence:i}=T(r,e)):i=U(r=t,e),{bridge:x(e),message:new c.af(n),emitter:new c.af(r),sequence:i,payer:new c.af(t),feeCollector:F(e),clock:c.aq,rent:c.ar,systemProgram:c.ao.programId}}function me(e,t,n,r,i){const a=re(t,e).methods.postVaa(1,r.guardianSet,r.timestamp,r.nonce,(0,c.aP)(r.emitterChain),[...r.emitterAddress.toUint8Array()],new c.aX(r.sequence.toString()),r.consistencyLevel,c.d.Buffer.from((0,c.dg)(r.payloadLiteral,r.payload)));return a._ixFn(...a._args,{accounts:le(t,n,i,r),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})}function le(e,t,n,r){return{guardianSet:V(e,r.guardianSet),bridge:x(e),signatureSet:new c.af(n),vaa:G(e,c.d.Buffer.from(r.hash)),payer:new c.af(t),clock:c.aq,rent:c.ar,systemProgram:c.ao.programId}}async function fe(e,t,n,r,i,a){const s=r.guardianSet,o=await W(e,t,s,a),u=r.signatures,d=o.keys,g=[];for(let m=0;m<Math.ceil(u.length/7);++m){const a=7*m,s=Math.min(u.length,7*(m+1)),o=new Array(19).fill(-1),l=[],f=[];for(let e=0;e<s-a;++e){const t=u.at(e+a);l.push(c.d.Buffer.from(t.signature.encode())),f.push(d.at(t.guardianIndex)),o[t.guardianIndex]=e}g.push(K(l,f,c.d.Buffer.from(r.hash))),g.push(pe(e,t,n,r,i,o))}return g}function pe(e,t,n,r,i,a){const s=re(t,e).methods.verifySignatures(a);return s._ixFn(...s._args,{accounts:he(t,n,i,r),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})}function he(e,t,n,r){return{payer:new c.af(t),guardianSet:V(e,r.guardianSet),signatureSet:new c.af(n),instructions:c.dh,rent:c.ar,systemProgram:c.ao.programId}}function ye(e,t){const{emitter:n,sequence:r}=T(e,t);return{wormholeBridge:x(t),wormholeEmitter:n,wormholeSequence:r,wormholeFeeCollector:F(t)}}function we(e,t,n,r){const i=ge(t,n,r,e);return{payer:i.payer,wormholeBridge:i.bridge,wormholeMessage:i.message,wormholeEmitter:i.emitter,wormholeSequence:i.sequence,wormholeFeeCollector:i.feeCollector,clock:i.clock,rent:i.rent,systemProgram:i.systemProgram}}const Se=Object.freeze(Object.defineProperty({__proto__:null,BridgeConfig:E,BridgeData:L,GuardianSetData:D,SequenceTracker:k,SignatureSetData:O,coder:ie,createBridgeFeeTransferInstruction:j,createInitializeInstruction:function(e,t,n,r,i,a){const s=re(t,e).methods.initialize(r,new c.aX(i.toString()),[...a.map(e=>[...new Uint8Array(e)])]);return s._ixFn(...s._args,{accounts:ue(t,n),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})},createPostMessageInstruction:de,createPostVaaInstruction:me,createReadOnlyWormholeProgramInterface:re,createSetFeesInstruction:function(e,t,n,r){const i=re(t,e).methods.setFees();return i._ixFn(...i._args,{accounts:ae(t,n,r),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})},createTransferFeesInstruction:function(e,t,n,r,i){const a=re(t,e).methods.transferFees();return a._ixFn(...a._args,{accounts:se(t,n,r,i),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})},createUpgradeContractInstruction:function(e,t,n,r){const i=re(t,e).methods.upgradeContract();return i._ixFn(...i._args,{accounts:ce(t,n,r),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})},createUpgradeGuardianSetInstruction:function(e,t,n,r){const i=re(t,e).methods.upgradeGuardianSet();return i._ixFn(...i._args,{accounts:oe(t,n,r),signers:void 0,remainingAccounts:void 0,preInstructions:void 0,postInstructions:void 0})},createVerifySignaturesInstructions:fe,createWormholeProgramInterface:ne,deriveClaimKey:A,deriveEmitterSequenceKey:U,deriveFeeCollectorKey:F,deriveGuardianSetKey:V,derivePostedVaaKey:G,deriveUpgradeAuthorityKey:N,deriveWormholeBridgeDataKey:x,deriveWormholeEmitterKey:q,getClaim:B,getEmitterKeys:T,getGuardianSet:W,getInitializeAccounts:ue,getPostMessageAccounts:ge,getPostMessageCpiAccounts:we,getPostVaaAccounts:le,getProgramSequenceTracker:z,getSequenceTracker:C,getSetFeesAccounts:ae,getSignatureSetData:async function(e,t,n){return e.getAccountInfo(new c.af(t),n).then(e=>O.deserialize((0,d.g)(e)))},getTransferFeesAccounts:se,getUpgradeContractAccounts:ce,getUpgradeGuardianSetAccounts:oe,getVerifySignatureAccounts:he,getWormholeBridgeData:P,getWormholeDerivedAccounts:ye},Symbol.toStringTag,{value:"Module"})),ve="Program log: Sequence: ";class Ie{constructor(e,t,n,r){p(this,"network"),p(this,"chain"),p(this,"connection"),p(this,"contracts"),p(this,"chainId"),p(this,"coreBridge"),p(this,"address"),p(this,"bridgeData"),this.network=e,this.chain=t,this.connection=n,this.contracts=r,this.chainId=(0,c.aP)(t);const i=r.coreBridge;if(!i)throw new Error("CoreBridge contract Address for chain ".concat(t," not found"));this.address=i,this.coreBridge=re(i,n)}async getGuardianSet(e){const t=await W(this.connection,this.coreBridge.programId,e);return{index:t.index,keys:t.keys.map(e=>e.toString("hex")),expiry:BigInt(t.expirationTime)}}static async fromRpc(e,t){const[n,r]=await g.a.chainFromRpc(e),i=t[r];if(i.network!==n)throw new Error("Network mismatch for chain ".concat(r,": ").concat(i.network," != ").concat(n));return new Ie(n,r,e,t[r].contracts)}async ensureBridgeConfig(){this.bridgeData||(this.bridgeData=await P(this.connection,this.coreBridge.programId))}async getMessageFee(){return await this.ensureBridgeConfig(),this.bridgeData.config.fee}async getGuardianSetIndex(){return await this.ensureBridgeConfig(),this.bridgeData.guardianSetIndex}publishMessage(e,t,n,r){var i=this;return(0,o.A)(function*(){const a=c.ap.generate(),o=new c.b1(e).unwrap(),u=de(i.connection,i.coreBridge.programId,o,a.publicKey,t,n,r),d=yield(0,s.A)(i.getMessageFee()),g=j(i.coreBridge.programId,o,d),m=new c.b2;m.feePayer=o,m.add(g,u),yield i.createUnsignedTx({transaction:m,signers:[a]},"Core.PublishMessage")})()}verifyMessage(e,t){var n=this;return(0,o.A)(function*(){yield*(0,i.A)((0,a.A)(n.postVaa(e,t)),s.A)})()}postVaa(e,t){var n=this;return(0,o.A)(function*(){const r=G(n.coreBridge.programId,c.d.Buffer.from(t.hash));if(yield(0,s.A)(n.connection.getAccountInfo(r)))return;const i=new c.b1(e).unwrap(),a=c.ap.generate(),o=yield(0,s.A)(fe(n.connection,n.coreBridge.programId,i,t,a.publicKey));for(let e=0;e<o.length;e+=2){const t=(new c.b2).add(...o.slice(e,e+2));t.feePayer=i,yield n.createUnsignedTx({transaction:t,signers:[a]},"Core.VerifySignature",!0)}const u=(new c.b2).add(me(n.connection,n.coreBridge.programId,i,t,a.publicKey));u.feePayer=i,yield n.createUnsignedTx({transaction:u},"Core.PostVAA")})()}static parseSequenceFromLog(e,t){var n,r,i,a;const{meta:s,transaction:{message:o}}=t;if(null==(n=null==s?void 0:s.innerInstructions)||!n.length)return[];const u=o.staticAccountKeys;if(0===u.filter(t=>t.toString()===e).length)return[];const d=null==(a=null==(i=null==(r=null==s?void 0:s.logMessages)?void 0:r.filter(e=>e.startsWith(ve)))?void 0:i[0])?void 0:a.replace(ve,"");if(!d)return[];const g=[];for(const c of null==s?void 0:s.innerInstructions){const t=c.instructions;g.push(...t.filter(t=>t.programIdIndex in u&&u[t.programIdIndex].toString()===e))}return g.length<1||u.length<3?[]:g.map(e=>[new c.b1(u[e.accounts[2]]).toUniversalAddress(),BigInt(d)]).filter(e=>null!==e)}async getMessageAccountKeys(e){let t;if("string"!=typeof e.transaction.message.version)if(e.meta.loadedAddresses)t=e.transaction.message.getAccountKeys({accountKeysFromLookups:e.meta.loadedAddresses});else{const n=await Promise.all(e.transaction.message.addressTableLookups.map(async e=>{const t=await this.connection.getAddressLookupTable(e.accountKey);if(!t||!t.value)throw new Error("Could not resolve lookup table: "+e.accountKey.toBase58());return t.value}));t=e.transaction.message.getAccountKeys({addressLookupTableAccounts:n})}else t=e.transaction.message.getAccountKeys();return t}async findInstructions(e,t){var n;const{meta:r,transaction:{message:i}}=t,a=this.coreBridge.programId;return[...null==(n=r.innerInstructions)?void 0:n.flatMap(t=>t.instructions.filter(t=>a.toString()===e.get(t.programIdIndex).toString())).map(e=>({programIdIndex:e.programIdIndex,accountKeyIndexes:e.accounts})),...i.compiledInstructions.filter(t=>a.toString()===e.get(t.programIdIndex).toString())]}async parsePostMessageAccount(e){const t=await this.connection.getAccountInfo(e);if(null==t||!t.data)throw new Error("No data found in message account");const{timestamp:n,emitterAddress:r,emitterChain:i,consistencyLevel:a,sequence:s,nonce:o,payload:u}=M(new Uint8Array(null==t?void 0:t.data));return(0,m.c)("Uint8Array",{guardianSet:await this.getGuardianSetIndex(),emitterChain:(0,c.aB)(i),timestamp:n,emitterAddress:r,consistencyLevel:a,sequence:s,nonce:o,payload:u,signatures:[]})}async parseTransaction(e){const t=await this.connection.getTransaction(e,{maxSupportedTransactionVersion:0});if(!t||!t.meta||!t.meta.innerInstructions)throw new Error("transaction not found");try{const e=Ie.parseSequenceFromLog(this.coreBridge.programId.toBase58(),t);if(e.length>0){const[t,n]=e[0];return[{chain:this.chain,emitter:t,sequence:n}]}}catch(a){}const n=await this.getMessageAccountKeys(t),r=await this.findInstructions(n,t);if(!r||0===r.length)throw new Error("no bridge messages found");const i=r.map(async e=>{const t=n.get(e.accountKeyIndexes[1]),r=await this.parsePostMessageAccount(t);return{chain:r.emitterChain,emitter:r.emitterAddress,sequence:r.sequence}});return await Promise.all(i)}async parseMessages(e){const t=await this.connection.getTransaction(e,{maxSupportedTransactionVersion:0});if(!t||!t.meta||!t.meta.innerInstructions)throw new Error("transaction not found");const n=await this.getMessageAccountKeys(t),r=await this.findInstructions(n,t);if(!r||0===r.length)throw new Error("no bridge messages found");const i=r.map(async e=>{const t=n.get(e.accountKeyIndexes[1]);return await this.parsePostMessageAccount(t)});return await Promise.all(i)}createUnsignedTx(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new g.S(e,this.network,this.chain,t,n)}}(0,l.r)(c.b3,"WormholeCore",Ie);const be=Object.freeze(Object.defineProperty({__proto__:null,IDL:te,SolanaWormholeCore:Ie,deserializePostMessage:M,postMessageLayout:b,utils:Se},Symbol.toStringTag,{value:"Module"}))}}]);
//# sourceMappingURL=5361.1eb73e45.chunk.js.map