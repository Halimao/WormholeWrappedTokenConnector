"use strict";(self.webpackChunkwormhole_connector=self.webpackChunkwormhole_connector||[]).push([[2993],{2993:(e,t,n)=>{n.r(t),n.d(t,{EvmPorticoBridge:()=>m});var r=n(600),o=n(6218),a=n(8951),i=n(9495),s=n(376),c=n(7547),d=n(3402),h=n(7171),u=n(200),f=n(4230),p=n(9801),w=Object.defineProperty,l=(e,t,n)=>((e,t,n)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);const g=new s.I(["function start((bytes32,address,address,address,address,address,uint256,uint256,uint256,uint256)) returns (address,uint16,uint64)","function receiveMessageAndSwap(bytes)"]),k=new s.I(["function quoteExactInputSingle((address,address,uint256,uint24,uint160)) public view returns (uint256,uint160,uint32,uint256)"]);class A{static async quoteRelayer(e,t,n){var r;if((0,c.j)(t)||(0,c.j)(n))throw new Error("how did you get here tho?");const o=c.a3.encode(t.toUniversalAddress().toUint8Array(),!1),a=c.a3.encode(n.toUniversalAddress().toUint8Array(),!1),i={targetChain:(0,c.aP)(e),sourceToken:o,targetToken:a};try{const e=await c.aA.post("https://gfx.relayers.xlabs.xyz/api/v1/swap/quote",i);return BigInt(e.data.fee)}catch(s){throw c.aA.isAxiosError(s)?new Error("Error getting relayer fee: ".concat(null==(r=s.response)?void 0:r.statusText)):s}}}const b={ETH:[c.W.tokenId("Arbitrum","native"),c.W.tokenId("Base","native"),c.W.tokenId("Ethereum","native"),c.W.tokenId("Optimism","native")],WETH:[c.W.tokenId("Arbitrum","0x82aF49447D8a07e3bd95BD0d56f35241523fBab1"),c.W.tokenId("Avalanche","0x49D5c2BdFfac6CE2BFdB6640F4F80f226bc10bAB"),c.W.tokenId("Base","0x4200000000000000000000000000000000000006"),c.W.tokenId("Bsc","0x2170Ed0880ac9A755fd29B2688956BD959F933F8"),c.W.tokenId("Ethereum","0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),c.W.tokenId("Optimism","0x4200000000000000000000000000000000000006"),c.W.tokenId("Polygon","0x7ceB23fD6bC0adD59E62ac25578270cFf1b9f619")],wstETH:[c.W.tokenId("Arbitrum","0x5979D7b546E38E414F7E9822514be443A4800529"),c.W.tokenId("Base","0xc1CBa3fCea344f92D9239c08C0568f6F2F0ee452"),c.W.tokenId("Ethereum","0x7f39C581F595B53c5cb19bD0b3f8dA6c935E2Ca0"),c.W.tokenId("Optimism","0x1F32b1c2345538c0c6f582fCB022739c4A194Ebb"),c.W.tokenId("Polygon","0x03b54A6e9a984069379fae1a4fC4dBAE93B3bCCD")],USDT:[c.W.tokenId("Arbitrum","0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9"),c.W.tokenId("Avalanche","0x9702230A8Ea53601f5cD2dc00fDBc13d4dF4A8c7"),c.W.tokenId("Base","0xfde4C96c8593536E31F229EA8f37b2ADa2699bb2"),c.W.tokenId("Bsc","0x55d398326f99059fF775485246999027B3197955"),c.W.tokenId("Ethereum","0xdAC17F958D2ee523a2206206994597C13D831ec7"),c.W.tokenId("Optimism","0x94b008aA00579c1307B0EF2c499aD98a8ce58e58"),c.W.tokenId("Polygon","0xc2132D05D31c914a87C6611C10748AEb04B58e8F"),c.W.tokenId("Celo","0x48065fbBE25f71C9282ddf5e1cD6D6A887483D5e")]};class m{constructor(e,t,n,r){if(l(this,"network"),l(this,"chain"),l(this,"provider"),l(this,"contracts"),l(this,"chainId"),l(this,"core"),l(this,"tokenBridge"),this.network=e,this.chain=t,this.provider=n,this.contracts=r,!r.portico)throw new Error("Unsupported chain, no contract addresses for: "+t);this.core=new d.EvmWormholeCore(e,t,n,r),this.tokenBridge=new h.EvmTokenBridge(e,t,n,r),this.chainId=c.ac.get(e,t)}static async fromRpc(e,t){const[n,r]=await u.E.chainFromRpc(e),o=t[r];if(o.network!==n)throw new Error("Network mismatch: ".concat(o.network," != ").concat(n));return new m(n,r,e,o.contracts)}transfer(e,t,n,s,d,h,u){var f=this;return(0,r.A)(function*(){const{minAmountStart:r,minAmountFinish:p}=u.swapAmounts;if(0n===r)throw new Error("Invalid min swap amount");if(0n===p)throw new Error("Invalid min swap amount");const w=new c.aR(e).toString(),[l,k]=(0,c.r)(f.network,f.chain,n),[A,b]=(0,c.r)(f.network,t.chain,d),m=(0,c.q)(k),E=(0,c.q)(yield(0,o.A)(f.getTransferrableToken(m))),C=(0,c.q)(t),v=(0,c.q)(b),y=(new Date).valueOf()%16,B=c.d6.serializeFlagSet({flags:{shouldWrapNative:l,shouldUnwrapNative:A},recipientChain:(0,c.aP)(t.chain),bridgeNonce:y,feeTierStart:100,feeTierFinish:100,padding:new Uint8Array(19)}),I=g.encodeFunctionData("start",[[B,m.toLowerCase(),E,v.toLowerCase(),C,h,s.toString(),r.toString(),p.toString(),u.relayerFee.toString()]]),T=f.getTokenGroup(k.address.toString()),F=f.getPorticoAddress(T);l||(yield*(0,a.A)((0,i.A)(f.approve(m,w,s,F)),o.A));const W={to:F,data:I,value:(yield(0,o.A)(f.core.getMessageFee()))+(l?s:0n)};yield f.createUnsignedTransaction((0,c.aU)(W,w),"PorticoBridge.Transfer")})()}redeem(e,t){var n=this;return(0,r.A)(function*(){const r=(0,c.aB)(t.payload.payload.flagSet.recipientChain),a=t.payload.payload.finalTokenAddress.toNative(r).toString(),i=n.getTokenGroup(a),d=n.getPorticoAddress(i),h=yield(0,o.A)(new s.C(d,g.fragments,n.provider).getFunction("receiveMessageAndSwap").populateTransaction((0,c.L)(t))),u=new c.aR(e).toString();yield n.createUnsignedTransaction((0,c.aU)(h,u),"PorticoBridge.Redeem")})()}async isTransferCompleted(e){return await this.tokenBridge.tokenBridge.isTransferCompleted((0,c.az)(e.hash))}async quoteSwap(e,t,n,r){const[,o]=(0,c.r)(this.network,this.chain,e),[,a]=(0,c.r)(this.network,this.chain,t),i=(0,c.q)(o),d=(0,c.q)(a);if((0,c.d7)(i,d))return r;const h=this.getQuoterAddress(n);return(await new s.C(h,k.fragments,this.provider).getFunction("quoteExactInputSingle").staticCall([i,d,r,100,0]))[0]}async quoteRelay(e,t){return await A.quoteRelayer(this.chain,e,t)}async getTransferrableToken(e){const t=c.W.tokenId(this.chain,e),[,n]=(0,c.r)(this.network,this.chain,t);if("Ethereum"===this.chain)return n;const r=Object.values(b).find(e=>e.find(e=>e.chain===this.chain&&(0,c.q)(e)===(0,c.q)(n)));if(!r)throw new Error("No token group found for ".concat(e," on ").concat(this.chain));const o=r.find(e=>"Ethereum"===e.chain);if(!o)throw new Error("No Ethereum origin token found for ".concat(e," on ").concat(this.chain));const a=await this.tokenBridge.getWrappedAsset(o);return c.W.tokenId(this.chain,a.toString())}supportedTokens(){const e=[];for(const[t,n]of Object.entries(b))for(const r of n)r.chain===this.chain&&e.push({group:t,token:r});return e}getTokenGroup(e){const t=this.supportedTokens().find(t=>(0,c.q)(t.token)===e);if(!t)throw new Error("Token not found");return t.group}approve(e,t,n,a){var i=this;return(0,r.A)(function*(){const r=u.E.getTokenImplementation(i.provider,e);if((yield(0,o.A)(r.allowance(t,a)))<n){const e=yield(0,o.A)(r.approve.populateTransaction(a,n));yield i.createUnsignedTransaction((0,c.aU)(e,t),"PorticoBridge.Approve")}})()}createUnsignedTransaction(e,t){return new f.E((0,c.aV)(e,this.chainId),this.network,this.chain,t,!1)}getPorticoAddress(e){const t=this.contracts.portico;return"USDT"===e&&t.porticoPancakeSwap||t.porticoUniswap}getQuoterAddress(e){const t=this.contracts.portico;return"USDT"===e&&t.pancakeSwapQuoterV2||t.uniswapQuoterV2}}(0,p.r)(c.aW,"PorticoBridge",m)}}]);
//# sourceMappingURL=2993.c2afe4da.chunk.js.map